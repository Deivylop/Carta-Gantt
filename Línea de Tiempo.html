<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cronograma Acueducto Puchuncaví</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body style="margin:0;padding:0;">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const CalendarIcon = ({ size=16, style }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    );
    const BarChartIcon = ({ size=16, style }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/>
      </svg>
    );
    const LayoutIcon = ({ size=16, style }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/>
      </svg>
    );
    const ActivityIcon = ({ size=16, style }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
      </svg>
    );
    const ClockIcon = ({ size=16, style }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
      </svg>
    );
    const InfoIcon = ({ size=16, style }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
    );

    const ganttData = [
      { id:1, name:"PROYECTO ACUEDUCTO PUCHUNCAVÍ - SAN ISIDRO - QUILAPILÚN", level:0, end:"2027-04-14", progress:87.9 },
      { id:2, name:"ACUEDUCTO", level:1, end:"2026-09-25", progress:83.9 },
      { id:3, name:"SECTOR 2000", level:2, end:"2026-03-28", progress:97.5 },
      { id:4, name:"SECTOR 3000", level:2, end:"2026-09-25", progress:78.6 },
      { id:5, name:"SECTOR 4000", level:2, end:"2026-08-28", progress:72.8 },
      { id:6, name:"SECTOR 5000", level:2, end:"2026-07-27", progress:92.3 },
      { id:7, name:"SECTOR 6000", level:2, end:"2026-04-23", progress:55.8 },
      { id:8, name:"ESTANQUES", level:1, end:"2027-02-13", progress:73.1 },
      { id:9, name:"ESTANQUE SAN ISIDRO (3.000m3)", level:2, end:"2026-02-02", progress:99.9 },
      { id:10, name:"ESTANQUE LA DORMIDA (820m3)", level:2, end:"2027-02-13", progress:0.0 },
      { id:11, name:"ESTANQUE QUILAPILUN (4.500m3)", level:2, end:"2026-04-01", progress:83.8 },
      { id:12, name:"ESTACIONES DE BOMBEO", level:1, end:"2026-04-23", progress:99.2 },
      { id:13, name:"ESTACIÓN DE BOMBEO PUCHUNCAVI", level:2, end:"2026-02-16", progress:99.7 },
      { id:14, name:"ESTACIÓN DE BOMBEO SAN ISIDRO", level:2, end:"2026-04-23", progress:98.7 },
      { id:15, name:"DISIPADORAS", level:1, end:"2026-05-24", progress:80.5 },
      { id:16, name:"DISIPADORA SAN ISIDRO", level:2, end:"2026-02-03", progress:99.9 },
      { id:17, name:"DISIPADORA QUILAPILUN", level:2, end:"2026-05-24", progress:61.9 },
      { id:18, name:"PRUEBAS Y PUESTA EN SERVICIO DEL SISTEMA", level:1, end:"2026-10-26", progress:0.0 }
    ];

    const historyData = {
      1:[{m:"May-25",end:"2026-09-17",p:53},{m:"Jun-25",end:"2027-09-28",p:71},{m:"Jul-25",end:"2027-08-22",p:74},{m:"Ago-25",end:"2027-08-22",p:77},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2027-01-25",p:75},{m:"Nov-25",end:"2027-02-22",p:78.89},{m:"Dic-25",end:"2027-03-30",p:83.9},{m:"Ene-26",end:"2027-04-14",p:87.9}],
      2:[{m:"May-25",end:"2026-01-31",p:38},{m:"Jun-25",end:"2027-06-10",p:51},{m:"Jul-25",end:"2027-05-04",p:57},{m:"Ago-25",end:"2027-05-04",p:63},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-07-18",p:67},{m:"Nov-25",end:"2026-08-15",p:72.05},{m:"Dic-25",end:"2026-08-13",p:78.7},{m:"Ene-26",end:"2026-09-25",p:83.9}],
      3:[{m:"May-25",end:"2025-10-30",p:48},{m:"Jun-25",end:"2026-03-30",p:60},{m:"Jul-25",end:"2026-03-24",p:70},{m:"Ago-25",end:"2026-03-22",p:75},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-02-08",p:90},{m:"Nov-25",end:"2026-01-23",p:95.39},{m:"Dic-25",end:"2026-02-28",p:97.5},{m:"Ene-26",end:"2026-03-28",p:97.5}],
      4:[{m:"May-25",end:"2026-01-31",p:35},{m:"Jun-25",end:"2027-06-10",p:48},{m:"Jul-25",end:"2027-05-04",p:52},{m:"Ago-25",end:"2027-05-04",p:58},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-07-18",p:60},{m:"Nov-25",end:"2026-08-15",p:65.44},{m:"Dic-25",end:"2026-07-13",p:72.5},{m:"Ene-26",end:"2026-09-25",p:78.6}],
      5:[{m:"May-25",end:"2026-01-31",p:0},{m:"Jun-25",end:"2026-02-09",p:0},{m:"Jul-25",end:"2026-03-10",p:0},{m:"Ago-25",end:"2026-04-06",p:0},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-06-10",p:3},{m:"Nov-25",end:"2026-07-08",p:24.27},{m:"Dic-25",end:"2026-08-13",p:54.0},{m:"Ene-26",end:"2026-08-28",p:72.8}],
      6:[{m:"May-25",end:"2025-12-20",p:49},{m:"Jun-25",end:"2026-08-11",p:71},{m:"Jul-25",end:"2026-09-14",p:80},{m:"Ago-25",end:"2026-10-12",p:84},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-04-30",p:79},{m:"Nov-25",end:"2026-05-28",p:82.38},{m:"Dic-25",end:"2026-07-03",p:87.9},{m:"Ene-26",end:"2026-07-27",p:92.3}],
      7:[{m:"May-25",end:"2026-01-31",p:0},{m:"Jun-25",end:"2026-07-27",p:0},{m:"Jul-25",end:"2026-08-30",p:0},{m:"Ago-25",end:"2026-09-27",p:0},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-03-10",p:4},{m:"Nov-25",end:"2026-04-07",p:8.3},{m:"Dic-25",end:"2026-04-17",p:39.4},{m:"Ene-26",end:"2026-04-23",p:55.8}],
      8:[{m:"May-25",end:"2026-07-19",p:61},{m:"Jun-25",end:"2026-03-08",p:57},{m:"Jul-25",end:"2026-04-12",p:57},{m:"Ago-25",end:"2026-05-10",p:57},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-11-26",p:68},{m:"Nov-25",end:"2026-12-24",p:67.66},{m:"Dic-25",end:"2027-01-29",p:68.1},{m:"Ene-26",end:"2027-02-13",p:73.1}],
      9:[{m:"May-25",end:"2025-08-17",p:86},{m:"Jun-25",end:"2025-08-05",p:88},{m:"Jul-25",end:"2025-10-26",p:88},{m:"Ago-25",end:"2025-11-23",p:88},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-01-24",p:88},{m:"Nov-25",end:"2026-02-21",p:88.09},{m:"Dic-25",end:"2026-03-29",p:89.0},{m:"Ene-26",end:"2026-02-02",p:99.9}],
      10:[{m:"May-25",end:"2026-07-19",p:0},{m:"Jun-25",end:"2025-12-23",p:0},{m:"Jul-25",end:"2026-01-27",p:0},{m:"Ago-25",end:"2026-02-24",p:0},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-11-26",p:0},{m:"Nov-25",end:"2026-12-24",p:0},{m:"Dic-25",end:"2027-01-29",p:0},{m:"Ene-26",end:"2027-02-13",p:0}],
      11:[{m:"May-25",end:"2025-08-10",p:68},{m:"Jun-25",end:"2025-09-08",p:82},{m:"Jul-25",end:"2025-10-10",p:82},{m:"Ago-25",end:"2025-11-01",p:83},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-01-07",p:83},{m:"Nov-25",end:"2026-02-04",p:83.31},{m:"Dic-25",end:"2026-03-12",p:83.5},{m:"Ene-26",end:"2026-04-01",p:83.8}],
      12:[{m:"May-25",end:"2025-12-01",p:34},{m:"Jun-25",end:"2026-06-27",p:55},{m:"Jul-25",end:"2026-07-25",p:59},{m:"Ago-25",end:"2026-03-02",p:61},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-01-21",p:77},{m:"Nov-25",end:"2026-02-18",p:86.38},{m:"Dic-25",end:"2026-03-26",p:95.6},{m:"Ene-26",end:"2026-04-23",p:99.2}],
      13:[{m:"May-25",end:"2025-10-15",p:23},{m:"Jun-25",end:"2026-02-20",p:48},{m:"Jul-25",end:"2026-07-08",p:52},{m:"Ago-25",end:"2026-03-02",p:53},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2025-12-16",p:78},{m:"Nov-25",end:"2025-12-29",p:90.84},{m:"Dic-25",end:"2026-02-03",p:97.4},{m:"Ene-26",end:"2026-02-16",p:99.7}],
      14:[{m:"May-25",end:"2025-12-01",p:44},{m:"Jun-25",end:"2026-06-27",p:63},{m:"Jul-25",end:"2026-07-25",p:66},{m:"Ago-25",end:"2026-01-11",p:68},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-01-21",p:76},{m:"Nov-25",end:"2026-02-18",p:82.08},{m:"Dic-25",end:"2026-03-26",p:93.8},{m:"Ene-26",end:"2026-04-23",p:98.7}],
      15:[{m:"May-25",end:"2026-01-31",p:0},{m:"Jun-25",end:null,p:null},{m:"Jul-25",end:null,p:null},{m:"Ago-25",end:null,p:null},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-03-12",p:52},{m:"Nov-25",end:"2026-03-30",p:58.52},{m:"Dic-25",end:"2026-04-28",p:64.6},{m:"Ene-26",end:"2026-05-24",p:80.5}],
      16:[{m:"May-25",end:"2025-10-30",p:0},{m:"Jun-25",end:null,p:null},{m:"Jul-25",end:null,p:null},{m:"Ago-25",end:null,p:null},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2025-11-19",p:83},{m:"Nov-25",end:"2025-12-17",p:84.95},{m:"Dic-25",end:"2026-01-22",p:92.9},{m:"Ene-26",end:"2026-02-03",p:99.9}],
      17:[{m:"May-25",end:"2026-01-31",p:0},{m:"Jun-25",end:null,p:null},{m:"Jul-25",end:null,p:null},{m:"Ago-25",end:null,p:null},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-03-12",p:23},{m:"Nov-25",end:"2026-03-30",p:33.38},{m:"Dic-25",end:"2026-04-28",p:37.7},{m:"Ene-26",end:"2026-05-24",p:61.9}],
      18:[{m:"May-25",end:"2026-03-31",p:0},{m:"Jun-25",end:"2027-07-30",p:0},{m:"Jul-25",end:"2027-06-23",p:0},{m:"Ago-25",end:"2027-06-23",p:0},{m:"Sep-25",end:null,p:null},{m:"Oct-25",end:"2026-08-08",p:0},{m:"Nov-25",end:"2026-09-05",p:0},{m:"Dic-25",end:"2026-10-11",p:0},{m:"Ene-26",end:"2026-10-26",p:0}]
    };

    const reportDatesMapping = {
      "May-25":"2025-05-01","Jun-25":"2025-06-01","Jul-25":"2025-07-01","Ago-25":"2025-08-01",
      "Sep-25":"2025-09-01","Oct-25":"2025-10-01","Nov-25":"2025-11-01","Dic-25":"2025-12-01","Ene-26":"2026-01-01"
    };

    const startTs = new Date("2025-05-01").getTime();
    const endTs = new Date("2027-12-31").getTime();
    const totalDuration = endTs - startTs;

    const markers = [
      {label:"May 25",date:"2025-05-01"},{label:"Sep 25",date:"2025-09-01"},
      {label:"Ene 26",date:"2026-01-01"},{label:"May 26",date:"2026-05-01"},
      {label:"Sep 26",date:"2026-09-01"},{label:"Ene 27",date:"2027-01-01"},
      {label:"May 27",date:"2027-05-01"},{label:"Sep 27",date:"2027-09-01"}
    ];

    const getPct = (d) => {
      if (!d) return 0;
      return Math.min(Math.max(((new Date(d).getTime()-startTs)/totalDuration)*100,0),100);
    };
    const fmtDate = (d) => {
      if (!d) return "N/A";
      const [y,m,dd]=d.split("-"); return `${dd}-${m}-${y}`;
    };

    function GanttRow({item, formatDate}) {
      const [hovered, setHovered] = useState(false);
      const bw = getPct(item.end);
      const barBg = item.level===0?"#e0e7ff":"#f1f5f9";
      const fillColor = item.level===0?"#4338ca":item.level===1?"#0ea5e9":"#34d399";
      return (
        <div
          style={{height:"48px",display:"flex",alignItems:"center",position:"relative",padding:"0 8px"}}
          onMouseEnter={()=>setHovered(true)}
          onMouseLeave={()=>setHovered(false)}
        >
          <div style={{position:"relative",height:"20px",borderRadius:"3px",overflow:"hidden",zIndex:10,background:barBg,width:`${bw}%`,minWidth:"4px"}}>
            <div style={{height:"100%",background:fillColor,width:`${item.progress}%`,opacity:0.9}}/>
          </div>
          <div style={{position:"absolute",left:`calc(${bw}% + 8px)`,width:"8px",height:"8px",borderRadius:"50%",background:"#1e293b",zIndex:10,marginLeft:"-4px"}}/>
          {hovered && (
            <div style={{position:"absolute",left:"12px",top:"2px",background:"#0f172a",color:"#fff",fontSize:"12px",padding:"6px 12px",borderRadius:"4px",zIndex:50,whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column",gap:"2px"}}>
              <span style={{fontWeight:"700",borderBottom:"1px solid #334155",paddingBottom:"3px"}}>{item.name}</span>
              <span>Fin Proyectado: {formatDate(item.end)}</span>
              <span>Avance Actual: {item.progress}%</span>
            </div>
          )}
        </div>
      );
    }

    function SlipRow({point, idx, selectedHistory, rowHeight}) {
      const [hovered, setHovered] = useState(false);
      const reportDateStr = reportDatesMapping[point.m];
      const reportPct = getPct(reportDateStr);
      const isNA = point.end === null;
      const endPct = isNA ? reportPct : getPct(point.end);
      const isBaseline = idx === 0;
      const leftPos = Math.min(reportPct, endPct);
      const barWidth = Math.abs(endPct - reportPct);
      const isNearRight = endPct > 78;

      let deltaDays = null;
      if (idx>0 && point.end) {
        let pve = null;
        for (let j=idx-1;j>=0;j--) { if(selectedHistory[j].end){pve=selectedHistory[j].end;break;} }
        if (pve) deltaDays = Math.round((new Date(`${point.end}T00:00:00`)-new Date(`${pve}T00:00:00`))/86400000);
      }
      let durDays = 0;
      if (!isNA) {
        durDays = Math.round(Math.abs(new Date(`${point.end}T00:00:00`)-new Date(`${reportDateStr}T00:00:00`))/86400000);
      }

      return (
        <div
          style={{display:"flex",alignItems:"center",height:`${rowHeight}px`,background:hovered?"#f8fafc":"#fff",position:"relative",transition:"background 0.1s"}}
          onMouseEnter={()=>setHovered(true)} onMouseLeave={()=>setHovered(false)}
        >
          <div style={{width:"192px",flexShrink:0,borderRight:"1px solid #e2e8f0",display:"flex",alignItems:"center",padding:"0 12px",zIndex:20,background:"#fff",height:"100%"}}>
            <span style={{fontSize:"12px",fontWeight:"600",padding:"3px 8px",borderRadius:"6px",border:`1px solid ${isBaseline?"#fde68a":"#e2e8f0"}`,background:isBaseline?"#fffbeb":"#f1f5f9",color:isBaseline?"#92400e":"#334155",whiteSpace:"nowrap"}}>
              {isBaseline?`Línea Base (${point.m})`:`Informe ${point.m}`}
            </span>
          </div>
          <div style={{flex:1,position:"relative",height:"100%",display:"flex",alignItems:"center"}}>
            <div style={{position:"absolute",left:`${reportPct}%`,width:"12px",height:"12px",borderRadius:"50%",background:isBaseline?"#fbbf24":"#cbd5e1",border:"2px solid #fff",zIndex:20,marginLeft:"-6px"}}/>
            {!isNA ? (
              <>
                <div style={{position:"absolute",left:`${leftPos}%`,width:`${barWidth}%`,height:"20px",borderRadius:"999px",background:isBaseline?"#fef3c7":"#e0e7ff",border:`1px solid ${isBaseline?"#fcd34d":"#a5b4fc"}`,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}}>
                  {barWidth>4 && <span style={{fontSize:"10px",fontWeight:"700",whiteSpace:"nowrap",padding:"0 4px",color:isBaseline?"#78350f":"#3730a3"}}>{durDays} días</span>}
                </div>
                <div style={{position:"absolute",left:`${endPct}%`,width:"16px",height:"16px",borderRadius:"50%",background:isBaseline?"#f59e0b":"#4338ca",border:"2px solid #fff",zIndex:20,marginLeft:"-8px",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}}/>
                <div style={{
                  position:"absolute",zIndex:30,display:"flex",alignItems:"center",gap:"5px",
                  background:"rgba(255,255,255,0.97)",padding:"3px 7px",borderRadius:"4px",
                  boxShadow:"0 1px 4px rgba(0,0,0,0.12)",border:"1px solid #e2e8f0",
                  fontSize:"11px",color:"#334155",whiteSpace:"nowrap",
                  top:"50%",transform:"translateY(-50%)",
                  left: isNearRight?"auto":`${endPct}%`,
                  right: isNearRight?`${100-endPct}%`:"auto",
                  marginLeft: isNearRight?0:"10px",
                  marginRight: isNearRight?"10px":0
                }}>
                  <CalendarIcon size={11} style={{color:isBaseline?"#d97706":"#6366f1"}}/>
                  <span style={{fontWeight:"700"}}>{fmtDate(point.end)}</span>
                  {deltaDays!==null && <>
                    <span style={{color:"#e2e8f0"}}>|</span>
                    <span style={{fontWeight:"700",color:deltaDays>0?"#ef4444":deltaDays<0?"#10b981":"#94a3b8"}}>
                      Δ {deltaDays>0?`+${deltaDays}`:deltaDays} días
                    </span>
                  </>}
                  <span style={{color:"#e2e8f0"}}>|</span>
                  <ActivityIcon size={11} style={{color:"#10b981"}}/>
                  <span>{point.p}% Avance</span>
                </div>
              </>
            ) : (
              <div style={{position:"absolute",left:`${reportPct}%`,marginLeft:"12px",zIndex:20,display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#94a3b8",background:"#f1f5f9",padding:"3px 8px",borderRadius:"4px",border:"1px solid #e2e8f0"}}>
                <ClockIcon size={12}/> NA (Sin datos)
              </div>
            )}
          </div>
        </div>
      );
    }

    function TimelineApp() {
      const [activeTab, setActiveTab] = useState("history");
      const [selectedId, setSelectedId] = useState(2);
      const selectedHistory = historyData[selectedId];
      const rowHeight = 64;

      const tabBtn = (id, label) => (
        <button onClick={()=>setActiveTab(id)} style={{
          padding:"8px 16px",borderRadius:"6px",border:"none",fontSize:"14px",fontWeight:"500",cursor:"pointer",
          background: activeTab===id?"#fff":"transparent",
          color: activeTab===id?"#3730a3":"#475569",
          boxShadow: activeTab===id?"0 1px 2px rgba(0,0,0,0.1)":"none"
        }}>{label}</button>
      );

      return (
        <div style={{minHeight:"100vh",background:"#f8fafc",fontFamily:"system-ui,sans-serif",padding:"16px"}}>
          {/* Header */}
          <div style={{background:"#fff",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e2e8f0",padding:"24px",marginBottom:"20px",display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",gap:"16px"}}>
            <div style={{display:"flex",alignItems:"center",gap:"16px"}}>
              <div style={{padding:"12px",background:"#eef2ff",color:"#4338ca",borderRadius:"8px"}}>
                <LayoutIcon size={28}/>
              </div>
              <div>
                <h1 style={{margin:0,fontSize:"22px",fontWeight:"700",color:"#1e293b"}}>Cronograma Acueducto Puchuncaví</h1>
                <p style={{margin:0,fontSize:"13px",color:"#64748b"}}>Visualización de líneas de tiempo y evolución de componentes</p>
              </div>
            </div>
            <div style={{display:"flex",background:"#f1f5f9",padding:"4px",borderRadius:"8px",gap:"2px"}}>
              {tabBtn("gantt","Gantt Actualizado")}
              {tabBtn("history","Evolución de Proyecciones")}
            </div>
          </div>

          {/* Contenido */}
          <div style={{background:"#fff",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #e2e8f0",overflow:"hidden"}}>

            {/* GANTT */}
            {activeTab==="gantt" && (
              <div style={{display:"flex",overflow:"hidden"}}>
                <div style={{width:"32%",minWidth:"260px",borderRight:"1px solid #e2e8f0",flexShrink:0}}>
                  <div style={{height:"48px",borderBottom:"1px solid #e2e8f0",background:"#f8fafc",display:"flex",alignItems:"center",padding:"0 16px",fontSize:"11px",fontWeight:"600",color:"#64748b",textTransform:"uppercase",letterSpacing:"0.05em"}}>
                    Estructura de Desglose
                  </div>
                  {ganttData.map(item=>(
                    <div key={item.id} title={item.name} style={{height:"48px",display:"flex",alignItems:"center",paddingLeft:`${item.level*1.5+1}rem`,paddingRight:"16px",borderBottom:"1px solid transparent"}}>
                      <span style={{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:"13px",fontWeight:item.level===0?"700":item.level===1?"600":"400",color:item.level===0?"#1e293b":item.level===1?"#334155":"#475569"}}>
                        {item.level>0 && <span style={{color:"#cbd5e1",marginRight:"6px"}}></span>}
                        {item.name}
                      </span>
                    </div>
                  ))}
                </div>
                <div style={{flex:1,overflowX:"auto"}}>
                  <div style={{minWidth:"800px",display:"flex",flexDirection:"column",position:"relative"}}>
                    <div style={{height:"48px",borderBottom:"1px solid #e2e8f0",background:"#f8fafc",position:"relative"}}>
                      {markers.map((m,i)=>(
                        <div key={i} style={{position:"absolute",left:`${getPct(m.date)}%`,height:"100%",display:"flex",alignItems:"center",justifyContent:"center",width:"64px",marginLeft:"-32px",fontSize:"11px",fontWeight:"600",color:"#64748b"}}>
                          {m.label}
                        </div>
                      ))}
                    </div>
                    <div style={{padding:"16px 0",position:"relative"}}>
                      {markers.map((m,i)=>(
                        <div key={i} style={{position:"absolute",top:0,bottom:0,left:`${getPct(m.date)}%`,borderLeft:"1px dashed #e2e8f0",zIndex:0}}/>
                      ))}
                      {ganttData.map(item=><GanttRow key={item.id} item={item} formatDate={fmtDate}/>)}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* SLIP CHART */}
            {activeTab==="history" && (
              <div style={{display:"flex",flexDirection:"column"}}>
                <div style={{padding:"24px",borderBottom:"1px solid #e2e8f0"}}>
                  <label style={{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px",fontWeight:"600",color:"#334155",marginBottom:"12px",textTransform:"uppercase",letterSpacing:"0.05em"}}>
                    <BarChartIcon size={16} style={{color:"#6366f1"}}/>
                    Seleccionar Componente para ver su Tendencia
                  </label>
                  <select
                    style={{width:"100%",maxWidth:"640px",padding:"10px 14px",border:"1px solid #cbd5e1",borderRadius:"8px",background:"#f8fafc",color:"#1e293b",fontWeight:"500",fontSize:"14px",outline:"none"}}
                    value={selectedId}
                    onChange={e=>setSelectedId(Number(e.target.value))}
                  >
                    {ganttData.map(item=>(
                      <option key={item.id} value={item.id}>
                        {item.level===0?"":{1:" ",2:" "}[item.level]}{item.name}
                      </option>
                    ))}
                  </select>
                  <div style={{marginTop:"14px",display:"flex",alignItems:"flex-start",gap:"8px",fontSize:"13px",color:"#475569",background:"#eff6ff",padding:"12px",borderRadius:"6px",border:"1px solid #dbeafe",maxWidth:"640px"}}>
                    <InfoIcon size={16} style={{color:"#3b82f6",flexShrink:0,marginTop:"1px"}}/>
                    <p style={{margin:0}}>Este gráfico muestra la fecha proyectada en cada reporte. La <strong style={{color:"#d97706"}}>Línea Base (LB)</strong> se resalta en color ámbar. Cada fila representa un mes de reporte; la barra muestra la extensión desde ese reporte hasta su fecha objetivo. La línea roja muestra el "deslizamiento" de las fechas.</p>
                  </div>
                </div>

                <div style={{overflowX:"auto",background:"#f8fafc",padding:"16px"}}>
                  <div style={{minWidth:"1000px",background:"#fff",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden"}}>
                    <div style={{height:"48px",borderBottom:"1px solid #e2e8f0",background:"#f1f5f9",display:"flex",position:"relative"}}>
                      <div style={{width:"192px",flexShrink:0,borderRight:"1px solid #e2e8f0",display:"flex",alignItems:"center",padding:"0 16px",fontSize:"11px",fontWeight:"700",color:"#64748b",textTransform:"uppercase"}}>
                        Mes del Reporte
                      </div>
                      <div style={{flex:1,position:"relative"}}>
                        {markers.map((m,i)=>(
                          <div key={i} style={{position:"absolute",left:`${getPct(m.date)}%`,height:"100%",display:"flex",alignItems:"center",justifyContent:"center",width:"64px",marginLeft:"-32px",fontSize:"11px",fontWeight:"600",color:"#64748b"}}>
                            {m.label}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div style={{position:"relative",paddingBottom:"24px",paddingTop:"8px"}}>
                      <div style={{position:"absolute",inset:0,left:"192px",pointerEvents:"none"}}>
                        {markers.map((m,i)=>(
                          <div key={i} style={{position:"absolute",top:0,bottom:0,left:`${getPct(m.date)}%`,borderLeft:"1px dashed #e2e8f0"}}/>
                        ))}
                      </div>

                      <svg style={{position:"absolute",inset:0,left:"192px",width:"calc(100% - 192px)",height:"100%",zIndex:10,pointerEvents:"none"}}>
                        {selectedHistory.map((point,i)=>{
                          if (!point.end) return null;
                          let prevIdx=-1;
                          for(let j=i-1;j>=0;j--){if(selectedHistory[j].end){prevIdx=j;break;}}
                          if(prevIdx===-1) return null;
                          return (
                            <line key={i}
                              x1={`${getPct(selectedHistory[prevIdx].end)}%`} y1={prevIdx*rowHeight+rowHeight/2}
                              x2={`${getPct(point.end)}%`} y2={i*rowHeight+rowHeight/2}
                              stroke="#ef4444" strokeWidth="2.5" strokeDasharray="4 4" opacity="0.6"
                            />
                          );
                        })}
                      </svg>

                      {selectedHistory.map((point,idx)=>(
                        <SlipRow key={idx} point={point} idx={idx} selectedHistory={selectedHistory} rowHeight={rowHeight}/>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<TimelineApp/>);
  </script>
</body>
</html>